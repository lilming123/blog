---
title: 代码思路
date: 2023-06-20 14:10:10
---
1. 获取沪深 300 股票池数据，接口不支持历史数据，这里的股票是目前的数据
2. 时间对象 now_date 表示目前的时间
3. 先初始化策略仓位，根据 2015 年 4 月 3 日（这一天是周五收盘日）的每个股票盈利因子数据（有些股票获取不到数据，要排除）选取 50 个股票，其余股票权重 0.001，剩下的股票按因子值分配权重。策略仓位是我下一周打算要投资的权重，会在每周五收盘时生成，为下周一开盘调仓提供依据，目前仓位是实际上我持有的仓位
4. 再将时间设置到周一（4 月 6 日开盘日），将策略仓位直接赋值给实际仓位，因为还没有持有期限，不用计算收益率
5. 再将时间设置到周五（4 月 10 日收盘日）
6. 从 2015 年 4 月 10 日开始循环执行下列步骤
	1. 如果是周五
		1. 重新生成策略仓位，与上文一致
	2. 如果是周一
			1. 获取每只股票的周收益率(（这周开盘价-上周开盘价）/上周开盘价)再乘对应的实际仓位的权重，再求和得出总收益率
			2. 将收益率放入周收益率列表中
			3. 将累计收益率放入累计收益率列表中
7. 计算最大回撤：在累计收益率曲线中从峰值到谷底之间的最大跌幅
8. 计算超额收益率：根据投资策略收益率与沪深 300 每周收益率相减得出